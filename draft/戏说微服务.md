# 戏说为服务

微服务的特点: 小，协同工作。相比于大的单体服务，微服务更灵活，易于管理，维护和运维(需要高素质的ops团队)。单体系统维护成本比较高在于多人经手之后没有人能够掌握系统全局，添加功能，修改bug都需要花费更多的时间来熟悉上下文。而且系统每次发布的错误率也增高。

 服务拆小之后没了单体系统的问题，但是也有它自身的问题。
如何拆分服务？如何划定系统的边界？服务划分后依赖关系是怎样的，单向依赖还是双向依赖？
每个服务需要了解的业务上下文怎么定？举个例子，下单后需要给用户发送邮件提醒，同时也需要发送一个旺旺提醒这段逻辑放到哪里实现？还有给用户提供一个扣费详情邮件这个应该在那做，支付系统还是订单系统？
比如事务问题，原来的数据库问题变成分布式事务。需要使用两三段事务提交吗？需要事务补偿吗？
锁。这个和事务类似。原来的数据库锁变成了分布式锁。复杂度又高了。

方法调用或数据库调用变http调用，性能问题马上浮现。原来的顺序调用怕是不行了吧。并行编程，你会吗？异步呢？更别提了？

服务多了地址放哪管呢？十个八个服务，丢配置文件妥妥没问题？但是如果十倍呢？放配置文件不太靠谱了吧？怎么着也得来个服务发现吧，服务好了告诉他，要啥服务问他要，服务挂了也通知它一声。

回去数数，那个应用每个几十个配置，还是那句话，一个两个十个八个没问题。多了呢，不好管。而且怎么着你也得有开发，测试，生产环境吧。总得配置数: 服务数 * 环境数 * 配置数。所以，产品经理一句话，这个变量可能会变，测试环境生产环境最好区分对待，他这一句话得要开发给他做多少事儿啊。

契约测试？大家都异爨单干了，怎么着你才不拆人家台，怎么着才能避免别人拆你台。这中间得有套契约吧。啥？你相信你的队友！还是信鬼吧。

如何做到快速安全的发布？一个服务被二十个服务用，发布的时候出冷汗不？那怎么着？自动化部署和运维你的来一套吧。容器呢，要上不？折腾呗。
